<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dienstagsfortbildung 2026</title>
  <style>
    :root {
      --bg: #fbfbff;
      --card: rgba(255,255,255,.92);
      --ink: #1f2937;
      --muted: #6b7280;
      --border: rgba(229,231,235,.9);
      --p1: #a7c7e7;
      --p2: #c7f0bd;
      --p3: #f7d6e0;
      --p4: #fde6b7;
      --shadow: 0 10px 28px rgba(31,41,55,.10);
      --radius: 16px;
      --focus: rgba(196,181,253,.30);
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--ink);
      background:
        radial-gradient(1200px 600px at 10% 0%, rgba(247,214,224,.65), transparent 60%),
        radial-gradient(1200px 600px at 90% 0%, rgba(199,240,189,.65), transparent 60%),
        radial-gradient(900px 450px at 50% 100%, rgba(167,199,231,.55), transparent 60%),
        var(--bg);
      min-height: 100vh;
      position: relative;
    }

    /* Brain-imaging theme: subtle SVG overlay (no external assets) */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: 0.22;
      background-image: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' width='900' height='600' viewBox='0 0 900 600'>\
  <defs>\
    <linearGradient id='g' x1='0' x2='1' y1='0' y2='1'>\
      <stop offset='0' stop-color='%23a7c7e7'/>\
      <stop offset='0.5' stop-color='%23c7f0bd'/>\
      <stop offset='1' stop-color='%23f7d6e0'/>\
    </linearGradient>\
    <filter id='blur' x='-20%' y='-20%' width='140%' height='140%'>\
      <feGaussianBlur stdDeviation='1.2'/>\
    </filter>\
  </defs>\
  <g fill='none' stroke='url(%23g)' stroke-width='2.2' filter='url(%23blur)' opacity='0.9'>\
    <path d='M260,310 C210,260 210,185 265,150 C290,110 350,85 405,95 C450,55 530,60 570,110 C640,120 700,180 690,255 C725,300 705,370 650,395 C640,450 580,490 520,470 C480,520 410,520 380,475 C320,490 260,450 255,385 C215,365 205,325 260,310 Z'/>\
    <path d='M330,160 C300,185 300,225 335,245 C305,270 310,310 350,325'/>\
    <path d='M420,120 C390,145 390,190 430,210 C405,235 410,280 450,295'/>\
    <path d='M510,135 C545,165 540,205 505,225 C535,255 530,300 490,315'/>\
    <path d='M605,165 C635,195 630,235 595,255 C625,285 615,330 575,345'/>\
    <path d='M300,370 C340,395 395,405 450,395 C505,385 560,350 600,320'/>\
  </g>\
  <g fill='none' stroke='%239ca3af' stroke-width='1' opacity='0.35'>\
    <circle cx='450' cy='300' r='230'/>\
    <circle cx='450' cy='300' r='180'/>\
    <circle cx='450' cy='300' r='130'/>\
  </g>\
</svg>");
      background-repeat: no-repeat;
      background-position: 80% 10%;
      background-size: min(900px, 92vw);
    }

    header {
      max-width: 1100px;
      margin: 0 auto;
      padding: 22px 18px 8px;
    }

    h1 {
      margin: 0 0 6px 0;
      font-size: clamp(22px, 2.6vw, 32px);
      letter-spacing: .2px;
    }

    .topline {
      display: flex;
      flex-wrap: wrap;
      gap: 10px 14px;
      align-items: baseline;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.35;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(167,199,231,.30), rgba(255,255,255,0));
      color: #374151;
      font-size: 13px;
    }

    main {
      max-width: 1100px;
      margin: 0 auto;
      padding: 14px 18px 34px;
      display: grid;
      grid-template-columns: 1.05fr 1.95fr;
      gap: 16px;
      align-items: start;
    }

    @media (max-width: 920px) {
      main { grid-template-columns: 1fr; }
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
      backdrop-filter: blur(4px);
    }

    .card h2 {
      margin: 0 0 12px 0;
      font-size: 16px;
    }

    .kv { display: grid; gap: 10px; }
    .kv .label { font-size: 12px; color: var(--muted); margin-bottom: 4px; }
    .kv .value { font-size: 18px; font-weight: 650; line-height: 1.25; }

    .meta {
      font-size: 12px;
      color: var(--muted);
      margin-top: 8px;
      line-height: 1.35;
    }

    hr {
      border: none;
      border-top: 1px solid var(--border);
      margin: 16px 0;
    }

    label {
      display: block;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
    }

    input[type="date"], input[type="text"], input[type="email"] {
      width: 100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      font-size: 14px;
      outline: none;
      background: rgba(255,255,255,.95);
    }

    input:focus {
      border-color: #c4b5fd;
      box-shadow: 0 0 0 4px var(--focus);
    }

    .search-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width: 560px) {
      .search-row { grid-template-columns: 1fr; }
    }

    .btns {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 6px;
    }

    button {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px 12px;
      cursor: pointer;
      font-size: 14px;
      background: linear-gradient(180deg, rgba(253,230,183,.60), rgba(255,255,255,0));
    }
    button.secondary {
      background: linear-gradient(180deg, rgba(167,199,231,.45), rgba(255,255,255,0));
    }
    button.danger {
      background: linear-gradient(180deg, rgba(247,214,224,.55), rgba(255,255,255,0));
    }
    button:active { transform: translateY(1px); }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      background: rgba(255,255,255,.95);
    }

    thead th {
      text-align: left;
      font-size: 12px;
      color: #374151;
      background: rgba(167,199,231,.22);
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
    }

    tbody td {
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
      font-size: 14px;
      vertical-align: top;
      white-space: pre; /* preserves spaces if present in Excel */
    }

    tbody tr:last-child td { border-bottom: none; }
    tbody tr:hover td { background: rgba(199,240,189,.22); }

    .footer {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 18px 26px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.35;
    }

    .hint {
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(199,240,189,.30), rgba(255,255,255,0));
      font-size: 12px;
      color: #374151;
      margin-top: 10px;
    }
  </style>
</head>

<body>
  <header>
    <h1>Dienstagsfortbildung 2026</h1>
    <div class="topline">
      <span class="chip">Lokale Zeit: <span id="localDateTime">…</span></span>
      <span>Es werden nur Termine ab heute angezeigt (keine vergangenen Vorträge).</span>
    </div>
  </header>

  <main>
    <section class="card">
      <h2>Nächster Vortrag</h2>
      <div class="kv" aria-live="polite">
        <div>
          <div class="label">Datum</div>
          <div class="value" id="nextDate">–</div>
        </div>
        <div>
          <div class="label">Referent:in</div>
          <div class="value" id="nextSpeaker">–</div>
        </div>
        <div class="meta" id="nextMeta"></div>
      </div>

      <hr />

      <h2>Suche</h2>
      <div class="search-row">
        <div>
          <label for="searchDate">Datum</label>
          <input id="searchDate" type="date" />
        </div>
        <div>
          <label for="searchSpeaker">Referent:in (Name, Teilstring)</label>
          <input id="searchSpeaker" type="text" placeholder="z.B. Blackham" />
        </div>
      </div>

      <div class="btns">
        <button id="btnSearch">Suchen</button>
        <button id="btnReset" class="secondary">Zurücksetzen</button>
      </div>

      <div class="meta" id="resultMeta">–</div>

      <hr />

      <h2>Anmeldung für E-Mail-Benachrichtigungen</h2>
      <label for="emailInput">E-Mail-Adresse</label>
      <input id="emailInput" type="email" placeholder="name@domain.tld" autocomplete="email" />

      <div class="btns">
        <button id="btnSubscribe">Anmelden</button>
        <button id="btnUnsubscribe" class="danger">Abmelden</button>
      </div>

      <div class="meta" id="subMeta">
        Hinweis: Diese HTML-Datei kann ohne Server keine echten E-Mails versenden. Sie speichert die E-Mail-Adresse lokal im Browser und versucht optional, einen Backend-Endpunkt aufzurufen.
      </div>

      <div class="hint">
        Produktivbetrieb: Implementieren Sie Endpunkte <code>/api/subscribe</code>, <code>/api/unsubscribe</code> und <code>/api/notify</code>, um Benachrichtigungen serverseitig zu senden.
      </div>
    </section>

    <section class="card">
      <h2>Plan 2026 (ab heute)</h2>
      <div class="meta" id="scheduleMeta">–</div>
      <div style="overflow:auto;">
        <table aria-label="Dienstagsfortbildung Plan 2026 (ab heute)">
          <thead>
            <tr>
              <th style="width: 170px;">Datum</th>
              <th>Referent:in</th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
    </section>
  </main>

  <div class="footer">
    Grundlage: Excel-Planung "Dienstagsfortbildung 2026". Referent:innen werden exakt wie in Excel angezeigt (inkl. Sonderzeichen und Leerzeichen).
  </div>

  <script>
    "use strict";

    // Daten direkt aus Excel (nur Jahr 2026). Referent:innen werden NICHT verändert.
    const DATA_2026 = [{"date":"2026-01-06","speaker":"Progress Report-Aebischer"},{"date":"2026-01-13","speaker":"Akinci"},{"date":"2026-01-20","speaker":"Psychogios"},{"date":"2026-01-27","speaker":"Blackham"},{"date":"2026-02-10","speaker":"Lieb"},{"date":"2026-02-17","speaker":"Lonak"},{"date":"2026-02-24","speaker":"Trogkas"},{"date":"2026-03-03","speaker":"Progress Report"},{"date":"2026-03-10","speaker":"Mutke"},{"date":"2026-03-17","speaker":"Oetke"},{"date":"2026-03-24","speaker":"Mahmutoglu"},{"date":"2026-03-31","speaker":"Progress Report"},{"date":"2026-04-07","speaker":"Stebner"},{"date":"2026-04-14","speaker":"Hamad"},{"date":"2026-04-21","speaker":"Stahl"},{"date":"2026-04-28","speaker":"Progress Report"},{"date":"2026-05-05","speaker":"Psychogios"},{"date":"2026-05-12","speaker":"Lieb"},{"date":"2026-05-19","speaker":"Blackham"},{"date":"2026-05-26","speaker":"Progress Report"},{"date":"2026-06-02","speaker":"Trogkas"},{"date":"2026-06-09","speaker":"Lonak"},{"date":"2026-06-16","speaker":"Mutke"},{"date":"2026-06-23","speaker":"Progress Report"},{"date":"2026-06-30","speaker":"Oetke"},{"date":"2026-07-07","speaker":"Akinci"},{"date":"2026-07-14","speaker":"Mahmutoglu"},{"date":"2026-07-21","speaker":"Progress Report"},{"date":"2026-07-28","speaker":"Stebner"},{"date":"2026-08-04","speaker":"Hamad"},{"date":"2026-08-11","speaker":"Stahl"},{"date":"2026-08-18","speaker":"Progress Report"},{"date":"2026-08-25","speaker":"Psychogios"},{"date":"2026-09-01","speaker":"Trogkas"},{"date":"2026-09-08","speaker":"Blackham"},{"date":"2026-09-15","speaker":"Lieb"},{"date":"2026-09-22","speaker":"Progress Report"},{"date":"2026-09-29","speaker":"Mutke"},{"date":"2026-10-06","speaker":"Akinci"},{"date":"2026-10-13","speaker":"Mahmutoglu"},{"date":"2026-10-20","speaker":"Progress Report"},{"date":"2026-10-27","speaker":"Stebner"},{"date":"2026-11-03","speaker":"Hamad"},{"date":"2026-11-10","speaker":"Stahl"},{"date":"2026-11-17","speaker":"Progress Report"},{"date":"2026-11-24","speaker":"Psychogios"},{"date":"2026-12-01","speaker":"Trogkas"},{"date":"2026-12-08","speaker":"Blackham"},{"date":"2026-12-15","speaker":"Lieb"},{"date":"2026-12-22","speaker":"Progress Report"},{"date":"2026-12-29","speaker":"Mutke"},{"date":"2027-01-05","speaker":"Akinci"}];

    function formatDateDE(isoDate) {
      const d = new Date(isoDate + "T00:00:00");
      const dd = String(d.getDate()).padStart(2, "0");
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const yyyy = d.getFullYear();
      return `${dd}.${mm}.${yyyy}`;
    }

    function normalize(s) {
      return (s ?? "").toString().toLowerCase();
    }

    function getTodayISO() {
      const now = new Date();
      return new Date(now.getFullYear(), now.getMonth(), now.getDate()).toISOString().slice(0, 10);
    }

    function getFutureRows() {
      const todayISO = getTodayISO();
      return DATA_2026
        .slice()
        .sort((a,b) => a.date.localeCompare(b.date))
        .filter(r => r.date >= todayISO);
    }

    function renderTable(rows) {
      const tbody = document.getElementById("tableBody");
      tbody.innerHTML = "";
      for (const r of rows) {
        const tr = document.createElement("tr");

        const tdDate = document.createElement("td");
        tdDate.textContent = formatDateDE(r.date);

        const tdSpeaker = document.createElement("td");
        tdSpeaker.textContent = r.speaker; // exact Excel value

        tr.appendChild(tdDate);
        tr.appendChild(tdSpeaker);
        tbody.appendChild(tr);
      }
    }

    function renderUpcomingAndSchedule() {
      const future = getFutureRows();

      document.getElementById("scheduleMeta").textContent =
        `${future.length} Termine (heute und zukünftig) im Jahr 2026.`;

      document.getElementById("resultMeta").textContent =
        `${future.length} Termine (keine Filter).`;

      renderTable(future);

      const upcoming = future.length ? future[0] : null;
      const nextDateEl = document.getElementById("nextDate");
      const nextSpeakerEl = document.getElementById("nextSpeaker");
      const metaEl = document.getElementById("nextMeta");

      if (!upcoming) {
        nextDateEl.textContent = "–";
        nextSpeakerEl.textContent = "–";
        metaEl.textContent = "Kein zukünftiger Termin in 2026 vorhanden.";
        return;
      }

      nextDateEl.textContent = formatDateDE(upcoming.date);
      nextSpeakerEl.textContent = upcoming.speaker; // exact Excel value
      metaEl.textContent = "Vergangene Termine werden nicht angezeigt.";
    }

    function applySearch() {
      const dateVal = document.getElementById("searchDate").value;
      const speakerVal = normalize(document.getElementById("searchSpeaker").value);

      let filtered = getFutureRows();
      if (dateVal) filtered = filtered.filter(r => r.date === dateVal);
      if (speakerVal) filtered = filtered.filter(r => normalize(r.speaker).includes(speakerVal));

      renderTable(filtered);

      const parts = [];
      if (dateVal) parts.push("Datum: " + formatDateDE(dateVal));
      if (speakerVal) parts.push("Referent:in: " + speakerVal);
      const filterText = parts.length ? parts.join(" | ") : "keine Filter";

      document.getElementById("resultMeta").textContent = `${filtered.length} Treffer (${filterText}).`;
    }

    function resetSearch() {
      document.getElementById("searchDate").value = "";
      document.getElementById("searchSpeaker").value = "";
      renderUpcomingAndSchedule();
    }

    // E-Mail Sign-up (lokal speichern + optionaler Backend-Call)
    function isValidEmail(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function getSubscribedEmail() {
      try { return localStorage.getItem("df_sub_email") || ""; }
      catch { return ""; }
    }

    function setSubscribedEmail(email) {
      try { localStorage.setItem("df_sub_email", email); } catch {}
    }

    async function postJSON(url, payload) {
      const res = await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      return res;
    }

    async function subscribe() {
      const email = (document.getElementById("emailInput").value || "").trim();
      const meta = document.getElementById("subMeta");

      if (!isValidEmail(email)) {
        meta.textContent = "Bitte eine gültige E-Mail-Adresse eingeben.";
        return;
      }

      setSubscribedEmail(email);
      meta.textContent = "Anmeldung lokal gespeichert. Optional: Backend wird kontaktiert …";

      try {
        await postJSON("/api/subscribe", { email, seriesTitle: "Dienstagsfortbildung 2026" });
        meta.textContent = "Anmeldung gespeichert. Backend wurde benachrichtigt.";
      } catch {
        meta.textContent = "Anmeldung lokal gespeichert. Kein Backend erreichbar (optional).";
      }
    }

    async function unsubscribe() {
      const email = (document.getElementById("emailInput").value || getSubscribedEmail() || "").trim();
      const meta = document.getElementById("subMeta");

      if (!email) {
        meta.textContent = "Keine E-Mail-Adresse gefunden.";
        return;
      }

      setSubscribedEmail("");
      meta.textContent = "Abmeldung lokal gespeichert. Optional: Backend wird kontaktiert …";

      try {
        await postJSON("/api/unsubscribe", { email, seriesTitle: "Dienstagsfortbildung 2026" });
        meta.textContent = "Abmeldung gespeichert. Backend wurde benachrichtigt.";
      } catch {
        meta.textContent = "Abmeldung lokal gespeichert. Kein Backend erreichbar (optional).";
      }
    }

    function updateLocalDateTime() {
      const el = document.getElementById("localDateTime");
      if (!el) return;
      const s = new Date().toLocaleString(undefined, {
        year: "numeric", month: "2-digit", day: "2-digit",
        hour: "2-digit", minute: "2-digit", second: "2-digit"
      });
      el.textContent = s;
    }

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("btnSearch").addEventListener("click", applySearch);
      document.getElementById("btnReset").addEventListener("click", resetSearch);

      document.getElementById("btnSubscribe").addEventListener("click", subscribe);
      document.getElementById("btnUnsubscribe").addEventListener("click", unsubscribe);

      document.getElementById("searchSpeaker").addEventListener("keydown", (e) => {
        if (e.key === "Enter") applySearch();
      });
      document.getElementById("searchDate").addEventListener("keydown", (e) => {
        if (e.key === "Enter") applySearch();
      });

      const existing = getSubscribedEmail();
      if (existing) document.getElementById("emailInput").value = existing;

      updateLocalDateTime();
      setInterval(updateLocalDateTime, 1000);

      renderUpcomingAndSchedule();
    });
  </script>
</body>
</html>

